!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).priorityPlus=n()}(this,function(){"use strict";var e,n,r,t,a=function(){return(a=Object.assign||function(e){for(var n,r=1,t=arguments.length;r<t;r++)for(var a in n=arguments[r])Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a]);return e}).apply(this,arguments)};function i(e,n){return void 0===n&&(n={}),new CustomEvent(e,{detail:n})}function o(){var e,n={eventReady:!1},r={addEventListener:(e=(new MessageChannel).port1).addEventListener.bind(e),dispatchEvent:e.dispatchEvent.bind(e),removeEventListener:e.removeEventListener.bind(e)},t=new Map;return{off:function(e,n){var a=t.get(n).wrappedCallback;return r.removeEventListener(e,a),this},on:function(e,a,i){function o(e){i&&!n.eventReady||a(e)}return void 0===i&&(i=!0),t.set(a,{eventType:e,wrappedCallback:o}),r.addEventListener(e,o),this},setEventReady:function(e){void 0===e&&(e=!0),n.eventReady=e},trigger:function(e){r.dispatchEvent(e)}}}function l(e,n){return void 0===n&&(n={}),"string"==typeof e?e:e(n)}function v(e,n,r){return function(e){return[!(e instanceof Element)&&"Target must be an HTMLElement.",(!e.children||!e.children.length)&&"Target must be the direct parent of the individual nav items."].filter(Boolean)}(e).concat(function(e,n){return Object.keys(e).map(function(e){return void 0===n[e]?"Unrecognised option: "+e:void 0}).filter(Boolean)}(n,r))}function s(e,n,r){!function(e){if(e&&e.length)throw new Error("\n- "+e.join("\n- "))}(v(e,n,r))}!function(e){e.ShowOverflow="showOverflow",e.HideOverflow="hideOverflow",e.ItemsChanged="itemsChanged"}(e||(e={})),function(e){e.Container="container",e.Main="main",e.PrimaryNavWrapper="primary-nav-wrapper",e.PrimaryNav="primary-nav",e.OverflowNav="overflow-nav",e.ToggleBtn="toggle-btn",e.NavItems="nav-item"}(r||(r={})),function(e){e.ButtonVisible="is-showing-toggle",e.OverflowVisible="is-showing-overflow",e.PrimaryHidden="is-hiding-primary"}(t||(t={}));var c={classNames:(n={},n[r.Container]=["p-plus-container"],n[r.Main]=["p-plus"],n[r.PrimaryNavWrapper]=["p-plus__primary-wrapper"],n[r.PrimaryNav]=["p-plus__primary"],n[r.OverflowNav]=["p-plus__overflow"],n[r.ToggleBtn]=["p-plus__toggle-btn"],n),defaultOverflowVisible:!1,innerToggleTemplate:"More"};return function(n,v){var u,d,f;void 0===v&&(v={});var p,m=o(),g={eventListeners:new Map,itemMap:new WeakMap,observer:void 0},y=a({},c,v,{classNames:a({},c.classNames,v.classNames)}),N=y.classNames,h=((u={})[r.Container]=void 0,u.clone=((d={})[r.Main]=void 0,d[r.NavItems]=void 0,d[r.ToggleBtn]=void 0,d),u.primary=((f={})[r.Main]=void 0,f[r.PrimaryNav]=void 0,f[r.NavItems]=void 0,f[r.OverflowNav]=void 0,f[r.ToggleBtn]=void 0,f),u),w=(p=new WeakMap,function(e,n){return p.get(e)||p.set(e,new Map(Array.from(e).reduce(function(e,r,t){return e.concat([[r,n[t]]])},[]))),p.get(e)});function M(e){return N[e].join(" ")}function b(e){return"data-"+e}function O(){var e,a=g.itemMap,i="\n      <div "+b(r.Main)+' class="'+M(r.Main)+'">\n        <div class="'+M(r.PrimaryNavWrapper)+'">\n          <'+n.tagName+"\n            "+b(r.PrimaryNav)+'\n            class="'+M(r.PrimaryNav)+'"\n          >\n            '+Array.from(n.children).map(function(e){return"<li "+b(r.NavItems)+">"+e.innerHTML+"</li>"}).join("")+"\n          </"+n.tagName+">\n        </div>\n        <button\n          "+b(r.ToggleBtn)+'\n          class="'+M(r.ToggleBtn)+'"\n          aria-expanded="false"\n        >'+l(y.innerToggleTemplate)+"</button>\n        <"+n.tagName+"\n          "+b(r.OverflowNav)+'\n          class="'+M(r.OverflowNav)+'"\n          aria-hidden="true"\n        >\n        </'+n.tagName+">\n      </div>\n    ",o=document.createElement("div");(e=o.classList).add.apply(e,N[r.Container]),o.setAttribute(b(r.Container),"true"),h[r.Container]=o;var v=document.createRange().createContextualFragment(i),s=v.cloneNode(!0);h.primary[r.Main]=v.querySelector("["+b(r.Main)+"]"),h.primary[r.PrimaryNav]=v.querySelector("["+b(r.PrimaryNav)+"]"),h.primary[r.NavItems]=Array.from(v.querySelectorAll("["+b(r.NavItems)+"]")),h.primary[r.OverflowNav]=v.querySelector("["+b(r.OverflowNav)+"]"),h.primary[r.ToggleBtn]=v.querySelector("["+b(r.ToggleBtn)+"]"),h.clone[r.Main]=s.querySelector("["+b(r.Main)+"]"),h.clone[r.NavItems]=Array.from(s.querySelectorAll("["+b(r.NavItems)+"]")),h.clone[r.ToggleBtn]=s.querySelector("["+b(r.ToggleBtn)+"]"),h.clone[r.Main].setAttribute("aria-hidden","true"),h.clone[r.Main].setAttribute("data-clone","true"),h.clone[r.Main].classList.add(N[r.Main][0]+"--clone"),h.clone[r.Main].classList.add(N[r.Main][0]+"--"+t.ButtonVisible),o.appendChild(v),o.appendChild(s),h.clone[r.NavItems].forEach(function(e){return a.set(e,r.PrimaryNav)}),n.parentNode.replaceChild(o,n)}function T(e){var n=function(e){var n=g.itemMap,t=h.primary[e].cloneNode();return h.clone[r.NavItems].filter(function(r){return n.get(r)===e}).forEach(function(e){t.appendChild(w(h.clone[r.NavItems],h.primary[r.NavItems]).get(e))}),t}(e);h.primary[e].parentNode.replaceChild(n,h.primary[e]),h.primary[e]=n}function C(e){var n=e.target,t=e.intersectionRatio;g.itemMap.set(n,t<.99?r.OverflowNav:r.PrimaryNav)}function E(n){n.forEach(C),[r.PrimaryNav,r.OverflowNav].forEach(T),m.trigger(function(n){var r=n.overflowCount;return i(e.ItemsChanged,{overflowCount:r})}({overflowCount:h.primary[r.OverflowNav].children.length})),m.setEventReady(!0)}function B(n){void 0===n&&(n=!0);var a=N[r.Main][0]+"--"+t.OverflowVisible;return h.primary[r.Main].classList[n?"add":"remove"](a),h.primary[r.OverflowNav].setAttribute("aria-hidden",n?"false":"true"),h.primary[r.ToggleBtn].setAttribute("aria-expanded",n?"true":"false"),m.trigger(i(n?e.ShowOverflow:e.HideOverflow)),this}function L(){var e=N[r.Main][0]+"--"+t.OverflowVisible;return B(!h.primary[r.Main].classList.contains(e)),this}function I(e){e.preventDefault(),L()}function P(e){var n,a=e.detail.overflowCount;void 0===(n=a>0)&&(n=!0),h.primary[r.Main].classList[n?"add":"remove"](N[r.Main][0]+"--"+t.ButtonVisible),"string"!=typeof y.innerToggleTemplate&&[h.primary[r.ToggleBtn],h.clone[r.ToggleBtn]].forEach(function(e){e.innerHTML=l(y.innerToggleTemplate,{toggleCount:h.primary[r.OverflowNav].children.length,totalCount:h.clone[r.NavItems].length})}),0===a&&B(!1),function(e){void 0===e&&(e=!0);var n=N[r.Main][0]+"--"+t.PrimaryHidden;h.primary[r.Main].classList[e?"add":"remove"](n),h.primary[r.PrimaryNav].setAttribute("aria-hidden",String(e))}(a===h.clone[r.NavItems].length)}return s(n,v,c),O(),g.observer=new IntersectionObserver(E,{root:h.clone[r.Main],rootMargin:"0px 0px 0px 0px",threshold:[.99]}),h.clone[r.NavItems].forEach(function(e){return g.observer.observe(e)}),h.primary[r.ToggleBtn].addEventListener("click",I),m.on(e.ItemsChanged,P,!1),y.defaultOverflowVisible&&B(!0),{destroy:function(){g.observer.disconnect(),h.primary[r.ToggleBtn].removeEventListener("click",I),Array.from(g.eventListeners.entries()).forEach(function(e){var n=e[0],r=e[1].eventType;m.off(r,n)}),h[r.Container].parentNode.replaceChild(n,h[r.Container])},getNavElements:function(){return a({},h.primary)},off:m.off,on:m.on,setOverflowNavOpen:B,toggleOverflowNav:L}}});
